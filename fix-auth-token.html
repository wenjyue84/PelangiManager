<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Authentication Token - Capsule Change Dialog</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .fix-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .step {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
            border-radius: 4px;
        }
        .success {
            color: #4caf50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .warning {
            color: #ff9800;
            font-weight: bold;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .code {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîß Fix Capsule Change Dialog Error</h1>
    <p class="warning">Error Pattern: "Something went wrong" with Error ID: error_1755970239029_zln3gm2gl</p>
    
    <div class="fix-section">
        <h2>üìã Solution from Troubleshooting Guide</h2>
        <p>Based on <strong>Problem #009</strong> and <strong>Problem #011</strong> patterns, this is likely an authentication token issue.</p>
        
        <div class="step">
            <h3>Step 1: Clear Authentication Token</h3>
            <p>Click the button below to clear your stored authentication token:</p>
            <button onclick="clearAuthToken()">Clear Auth Token</button>
            <div id="tokenStatus"></div>
        </div>
        
        <div class="step">
            <h3>Step 2: Clear Browser Storage</h3>
            <p>Manual method (if button doesn't work):</p>
            <div class="code">
                1. Press F12 to open DevTools<br>
                2. Go to Application tab<br>
                3. Click Local Storage ‚Üí http://localhost:5000<br>
                4. Delete the 'auth_token' key<br>
                5. Close DevTools
            </div>
        </div>
        
        <div class="step">
            <h3>Step 3: Refresh and Re-login</h3>
            <p>After clearing the token:</p>
            <ol>
                <li>Refresh the page (F5)</li>
                <li>You should be redirected to login</li>
                <li>Login with: admin@pelangi.com / admin123</li>
                <li>Navigate back to Dashboard</li>
                <li>Try clicking a blue capsule badge again</li>
            </ol>
        </div>
    </div>

    <div class="fix-section">
        <h2>üß™ Test After Fix</h2>
        <div class="step">
            <h3>Verification Steps</h3>
            <ol>
                <li><strong>Login successful</strong> - No errors on login page</li>
                <li><strong>Dashboard loads</strong> - Guest table shows with blue capsule badges</li>
                <li><strong>Click capsule badge</strong> - Dialog should open without error</li>
                <li><strong>Dialog shows capsules</strong> - Available capsules list appears</li>
                <li><strong>No error page</strong> - Should not redirect to error page</li>
            </ol>
        </div>
    </div>

    <div class="fix-section">
        <h2>üîç Debug Information</h2>
        <div id="debugInfo">
            <p>Current auth token status: <span id="currentToken">Checking...</span></p>
            <p>Local storage keys: <span id="storageKeys">Loading...</span></p>
        </div>
        <button onclick="checkDebugInfo()">Refresh Debug Info</button>
    </div>

    <script>
        function clearAuthToken() {
            try {
                const oldToken = localStorage.getItem('auth_token');
                localStorage.removeItem('auth_token');
                
                const statusDiv = document.getElementById('tokenStatus');
                if (oldToken) {
                    statusDiv.innerHTML = '<p class="success">‚úÖ Auth token cleared successfully!</p><p>Token was: ' + oldToken.substring(0, 20) + '...</p>';
                } else {
                    statusDiv.innerHTML = '<p class="warning">‚ö†Ô∏è No auth token found to clear</p>';
                }
                
                // Update debug info
                setTimeout(checkDebugInfo, 100);
            } catch (error) {
                document.getElementById('tokenStatus').innerHTML = '<p class="error">‚ùå Error clearing token: ' + error.message + '</p>';
            }
        }
        
        function checkDebugInfo() {
            try {
                const token = localStorage.getItem('auth_token');
                const tokenStatus = token ? 'Present (' + token.substring(0, 20) + '...)' : 'Not found';
                document.getElementById('currentToken').textContent = tokenStatus;
                
                const keys = Object.keys(localStorage);
                document.getElementById('storageKeys').textContent = keys.length > 0 ? keys.join(', ') : 'None';
            } catch (error) {
                document.getElementById('currentToken').textContent = 'Error: ' + error.message;
                document.getElementById('storageKeys').textContent = 'Error: ' + error.message;
            }
        }
        
        // Check debug info on page load
        checkDebugInfo();
        
        // Log for debugging
        console.log('üîß Auth token fix page loaded');
        console.log('Current localStorage keys:', Object.keys(localStorage));
        console.log('Auth token present:', !!localStorage.getItem('auth_token'));
    </script>
</body>
</html>
