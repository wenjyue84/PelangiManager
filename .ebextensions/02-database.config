# Database configuration for PelangiManager on AWS RDS
# This sets up PostgreSQL database connection and initialization

option_settings:
  # Database environment variables
  aws:elasticbeanstalk:application:environment:
    # RDS connection details (will be injected by AWS)
    # DATABASE_URL: "postgresql://username:password@host:port/dbname"
    
    # Database initialization settings
    DB_POOL_MIN: 2
    DB_POOL_MAX: 10
    DB_CONNECTION_TIMEOUT: 30000
    
    # Session configuration
    SESSION_SECRET: "your-secure-session-secret-change-this"
    SESSION_STORE: "memory"

# Commands to run during deployment
commands:
  01_install_postgresql_client:
    command: "yum install -y postgresql postgresql-devel"
    ignoreErrors: true
    
container_commands:
  01_run_db_migrations:
    command: "npm run db:push"
    leader_only: true
    ignoreErrors: true